<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kaphein.template.cmstemplatebatis.auth.batis.RememberMeTokenMapper">
    <insert id="insert" parameterType="map" keyColumn="series_id" keyProperty="seriesId" useGeneratedKeys="true">
        <![CDATA[
            INSERT INTO t_remember_me_token
            (
                series_id
                , login_name
                , token_value
                , last_used_at
            )
            VALUES
            (
                #{seriesId}
                , #{loginName}
                , #{tokenValue}
                , #{lastUsedAt}
            )
        ]]>
    </insert>

    <update id="update" parameterType="map">
        <![CDATA[
            UPDATE t_remember_me_token
        ]]>
        <set>
            <if test="_parameter.containsKey('tokenValue')" >
                <![CDATA[
                    token_value = #{tokenValue},
                ]]>
            </if>
            <if test="_parameter.containsKey('lastUsedAt')" >
                <![CDATA[
                    last_used_at = #{lastUsedAt},
                ]]>
            </if>
        </set>
        <![CDATA[
            WHERE
                series_id = #{seriesId}
        ]]>
    </update>

    <delete id="delete" parameterType="map">
        <![CDATA[
            DELETE
            FROM
                t_remember_me_token
            WHERE
        ]]>
        <choose>
            <when test="_parameter.containsKey('loginName')">
                <![CDATA[
                    login_name = #{loginName}
                ]]>
            </when>
            <otherwise>
                <![CDATA[
                    series_id = #{seriesId}
                ]]>
            </otherwise>
        </choose>
    </delete>

    <select id="findOneBySeriesId" resultType="map" parameterType="map">
        <![CDATA[
            SELECT
                *
            FROM
                t_remember_me_token
            WHERE
                series_id = #{seriesId}
        ]]>
    </select>
</mapper>
